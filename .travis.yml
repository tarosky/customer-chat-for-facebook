sudo: false
dist: trusty

language: php

notifications:
  email:
    on_success: never
    on_failure: change

branches:
  only:
    - master
    - "/^v?[0-9\\.]+/"
cache:
  directories:
    - $HOME/.composer/cache

matrix:
  include:
    - php: 7.2
      env: WP_VERSION=trunk
    - php: 7.0
      env: WP_VERSION=trunk
    - php: 7.2
      env: WP_VERSION=latest
    - php: 7.0
      env: WP_VERSION=latest WP_PULUGIN_DEPLOY=1

env:
  global:
    - SVN_REPO: https://plugins.svn.wordpress.org/customer-chat-for-facebook-messenger/
    - secure: "2sgJqH61pz/KY9bxuhMuJ/uE2StJ3gSnxelj6KiLtPyuRNXfvWQQv1misOHRWCP5fajhOE7t7TfrlpzXpy89+1cPRWGzyQZBpdBKAxXvEMzLclVyVg3hK0ui4JAnXEvl581u+IUbJvtcQjGyzYE69osh93bPaE6GKswObjjkX3xw4SiZs5dgHq5hJBqsEhx36I/4oVJxjNt2I5Ih46tZRB+LmRfAwx1hhgD/nbXf9SI2Qr9BXi1sixoK+HMuHcEpbYewXHmO1+mK2SqWShUEXpUnl40kCYRwhQidGufHE17METCNEMfNKelkv5mfj7aMffNO2eUD4LegaIt78wLsRHthenYmrOyyCcQEbPB4Atht2e2vY3K3XkavR3EUobODHZvjhR4MwvH0VTbRpLoHd7UFFsyTBmpZ2oNN/pGFq/6z0hZfhtBI91d1zzl5FJsiyDX7Wzw0xFgLCsW4NHpKhs7nlcOtaFmC/849Ij+YegQtxk0/zwxLXSb+fc30Ndj9TlYfQk1CjS1Jz5g+eTv8qItvYP6MAXyy65SJRG7Qx8e2E1INqNMc63bcPbYbQcMpuFXi58VeTN9QVCZYZgIcGdzeq3UYUcoW2uWYSK5A8yqv6ExjGbeEJfS10YqPMwg4D4EFc0RG6pCquA9sfPPbKqb0RazVPoilfpdPo1kXNeE="

before_script:
  - export PATH="$HOME/.composer/vendor/bin:$PATH"
  - |
    if [ -f ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini ]; then
      phpenv config-rm xdebug.ini
    else
      echo "xdebug.ini does not exist"
    fi
  - |
    if [[ ! -z "$WP_VERSION" ]] ; then
      bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
      composer global require "phpunit/phpunit=4.8.*|5.7.*"
    fi

script:
  - phpunit

after_success: curl -L https://raw.githubusercontent.com/miya0001/travis2wpplugin/master/deploy.sh | bash
