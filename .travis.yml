sudo: false
dist: trusty

language: php

notifications:
  email:
    on_success: never
    on_failure: change

branches:
  only:
    - master
    - "/^v?[0-9\\.]+/"
cache:
  directories:
    - $HOME/.composer/cache

matrix:
  include:
    - php: 7.2
      env: WP_VERSION=trunk
    - php: 7.0
      env: WP_VERSION=trunk
    - php: 7.2
      env: WP_VERSION=latest
    - php: 7.0
      env: WP_VERSION=latest WP_PULUGIN_DEPLOY=1

env:
  global:
    - SVN_REPO: https://plugins.svn.wordpress.org/customer-chat-for-facebook-messenger/
    - secure: "yh7IooZ2I3jBCfQwZrgmlMWq53EbThGls3/zOHdC4X64q3VVaJqOEmuF/yYFPhtjrKyQy3AvN1uKak/ZGjDpQewcx1Av6BaHZX+wIXlsQ7PyZEkK8AcMvp6NfEnhyBKuVLKS7/K9g6GHdYiZvmdruTTraxDxKDudgDnKElEGHSzX5kAWGYHCRc4kG7kCnezfHgDUh4xVUKRcWbU4oySyLDYwsHy3Lc+Xs09cgsbthIC+nqwcDEZQX0NEa9RGN+RIXjwOivOI2DEm5PRymfl5jelvhjsf0xM4jb1TBgQ1PaUXdCaot6sbMPXrzgsWb6eM0extsDjwvu3VecvcmhPshljj7/iU5HSjMrTP0F8ZHImTUpa0d4xGkW+ODKmuh/sH53Cd0pSMunu6F/Mozo1mf2NrZ9sym2IAatVJgJp7T/rhD4FfM54soowETedid0yjtHIFbmnVnE6LWudRlfNsqeWGIydraIxsfvalHmoHMGOWkpqzFjV7+GL0vYFGh5HVwy0gIbGWqCbc09TryMCR8ojVd6G73SMezqTKF6bcZ2DuclucyRt9OLgMZQXghwWXapYtTFLlFJWxlYq1za8RmwsKQVdj4fnhc6vW2qPYG8XI9dEZPL9Zi8NDX6Qwuey/5brJ4T+eQB8Kl4JhS/rRcfknBLiY4pP/COgQ3FWISp0="

before_script:
  - export PATH="$HOME/.composer/vendor/bin:$PATH"
  - |
    if [ -f ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/xdebug.ini ]; then
      phpenv config-rm xdebug.ini
    else
      echo "xdebug.ini does not exist"
    fi
  - |
    if [[ ! -z "$WP_VERSION" ]] ; then
      bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
      composer global require "phpunit/phpunit=4.8.*|5.7.*"
    fi

script:
  - phpunit

after_success: curl -L https://raw.githubusercontent.com/miya0001/travis2wpplugin/master/deploy.sh | bash
